<div class="modal-content" style="border-radius: 12px; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.1);">
    <div class="modal-header"
        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px 12px 0 0; padding: 1.5rem;">
        <h5 class="modal-title" style="font-weight: 700;">
            <i class="fas fa-blender"></i> Costo de Preparación: {{ parent_insumo.nombre }}
        </h5>
        <button type="button" class="close" onclick="closeModal()" style="color: white; opacity: 0.8;">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="modal-body" style="padding: 2rem;">
        <!-- INFO RECETA -->
        <div class="alert alert-info" style="border-radius: 8px; font-size: 0.9em;">
            <i class="fas fa-info-circle"></i>
            Esta es una <strong>Sub-receta</strong> (Batch). Define los ingredientes para preparar
            <strong>una unidad</strong> de {{ parent_insumo.nombre }} ({{ parent_insumo.get_unidad_medida_display }}).
        </div>

        <!-- FORMULARIO -->
        <form hx-post="{% url 'pedidos:gestion_receta_insumo' parent_insumo.id %}" hx-target="#modal-container"
            class="mb-4">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-7">
                    <label style="font-weight: 600; color: #4a5568;">Ingrediente:</label>
                    {{ form.insumo }}
                </div>
                <div class="col-md-3">
                    <label style="font-weight: 600; color: #4a5568;">Cantidad:</label>
                    {{ form.cantidad_necesaria }}
                </div>
                <div class="col-md-2" style="display: flex; align-items: flex-end;">
                    <button type="submit" class="btn btn-success btn-block" style="font-weight: 600;">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
        </form>

        <!-- TABLA INGREDIENTES -->
        <h6
            style="font-weight: 700; color: #2d3748; margin-bottom: 1rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem;">
            Ingredientes de la Preparación
        </h6>

        <div class="table-responsive">
            <table class="table table-hover" style="font-size: 0.95rem;">
                <thead style="background: #f7fafc;">
                    <tr>
                        <th>Ingrediente</th>
                        <th class="text-center">Cantidad</th>
                        <th class="text-right">Costo Est.</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in recetas %}
                    <tr>
                        <td>{{ r.insumo.nombre }}</td>
                        <td class="text-center">
                            {{ r.cantidad_necesaria|floatformat:3 }} {{ r.insumo.unidad_medida }}
                        </td>
                        <td class="text-right text-muted">
                            ${{ r.insumo.costo_unitario|floatformat:2 }}
                        </td>
                        <td class="text-right">
                            <button hx-post="{% url 'pedidos:eliminar_ingrediente_insumo' r.id %}"
                                hx-confirm="¿Quitar ingrediente?" class="btn btn-sm text-danger">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center text-muted" style="padding: 2rem;">
                            No hay ingredientes asignados a esta preparación.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    function closeModal() {
        document.getElementById('modal-container').innerHTML = '';
    }
</script>